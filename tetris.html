<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Tetris Táctil</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  body { background: #0f172a; color: #fff; display: flex; flex-direction: column; align-items: center; min-height: 100vh; font-family: sans-serif; }
  #tetris { display: grid; grid-template-columns: repeat(10,2rem); grid-template-rows: repeat(20,2rem); gap: 2px; background:#1e293b; margin:1rem auto; }
  .cell { width:2rem; height:2rem; background:#0f172a; border-radius:0.25rem; transition:0.2s; }
  .I{background:#06b6d4;} .J{background:#2563eb;} .L{background:#f97316;} .O{background:#eab308;} .S{background:#22c55e;} .T{background:#a855f7;} .Z{background:#ef4444;}
  #next-piece{display:grid;grid-template-columns:repeat(4,1fr);grid-template-rows:repeat(4,1fr);width:8rem;height:8rem;margin:0.5rem auto;background:#0f172a;gap:1px;}
  #controls { display:flex; justify-content:center; gap:1rem; margin-top:1rem; flex-wrap:wrap;}
  .btn {width:4rem;height:4rem;background:#334155;border-radius:0.5rem;display:flex;align-items:center;justify-content:center;font-size:1.5rem;user-select:none;}
  #level-selector { margin:1rem auto; }
</style>
</head>
<body>
<h1 class="text-3xl font-bold mt-4">Tetris Táctil</h1>

<div id="level-selector">
  Nivel: 
  <select id="level">
    <option value="1">1</option>
    <option value="2">2</option>
    <option value="3">3</option>
    <option value="4">4</option>
    <option value="5">5</option>
  </select>
  <button id="start-button" class="ml-2 bg-indigo-600 px-4 py-1 rounded">Start</button>
</div>

<div id="tetris"></div>
<div id="next-piece"></div>

<div id="controls">
  <div class="btn" id="left">&#8592;</div>
  <div class="btn" id="rotate">&#8635;</div>
  <div class="btn" id="right">&#8594;</div>
  <div class="btn" id="down">&#8595;</div>
</div>

<script>
const COLS=10,ROWS=20;
const TETROMINOS={
  I:[[[1,1,1,1]],[[1],[1],[1],[1]]],
  J:[[[1,0,0],[1,1,1]],[[1,1],[1,0],[1,0]],[[1,1,1],[0,0,1]],[[0,1],[0,1],[1,1]]],
  L:[[[0,0,1],[1,1,1]],[[1,0],[1,0],[1,1]],[[1,1,1],[1,0,0]],[[1,1],[0,1],[0,1]]],
  O:[[[1,1],[1,1]]],
  S:[[[0,1,1],[1,1,0]],[[1,0],[1,1],[0,1]]],
  T:[[[0,1,0],[1,1,1]],[[1,0],[1,1],[1,0]],[[1,1,1],[0,1,0]],[[0,1],[1,1],[0,1]]],
  Z:[[[1,1,0],[0,1,1]],[[0,1],[1,1],[1,0]]]
};
const COLORS={I:"I",J:"J",L:"L",O:"O",S:"S",T:"T",Z:"Z"};

let board=[],currentPiece=null,currentX=0,currentY=0,currentRotation=0;
let score=0,level=1,linesCleared=0,dropInterval=1000,dropTimer=null,isGameOver=false;
let nextPiece=null;

const tetrisEl=document.getElementById("tetris");
const nextPieceEl=document.getElementById("next-piece");
const startButton=document.getElementById("start-button");
const levelSelect=document.getElementById("level");

function initBoard(){
  board=[]; tetrisEl.innerHTML="";
  for(let r=0;r<ROWS;r++){
    board[r]=[];
    for(let c=0;c<COLS;c++){
      board[r][c]="";
      const cell=document.createElement("div");
      cell.classList.add("cell");
      tetrisEl.appendChild(cell);
    }
  }
}

function draw(){
  for(let r=0;r<ROWS;r++){
    for(let c=0;c<COLS;c++){
      const cellIndex=r*COLS+c;
      const cell=tetrisEl.children[cellIndex];
      cell.className="cell";
      if(board[r][c]) cell.classList.add(board[r][c]);
    }
  }
  if(currentPiece){
    const shape=TETROMINOS[currentPiece][currentRotation];
    for(let r=0;r<shape.length;r++){
      for(let c=0;c<shape[r].length;c++){
        if(shape[r][c]){
          const x=currentX+c, y=currentY+r;
          if(y>=0 && y<ROWS && x>=0 && x<COLS){
            const cellIndex=y*COLS+x;
            tetrisEl.children[cellIndex].classList.add(COLORS[currentPiece]);
          }
        }
      }
    }
  }
}

function getCurrentShape(){ return TETROMINOS[currentPiece][currentRotation]; }
function isValidPosition(x,y,rotation){
  const shape=TETROMINOS[currentPiece][rotation];
  for(let r=0;r<shape.length;r++){
    for(let c=0;c<shape[r].length;c++){
      if(shape[r][c]){
        const newX=x+c,newY=y+r;
        if(newX<0||newX>=COLS||newY>=ROWS||(newY>=0 && board[newY][newX])) return false;
      }
    }
  }
  return true;
}

function placePiece(){
  const shape=getCurrentShape();
  for(let r=0;r<shape.length;r++){
    for(let c=0;c<shape[r].length;c++){
      if(shape[r][c]){
        const x=currentX+c, y=currentY+r;
        if(y>=0 && y<ROWS && x>=0 && x<COLS) board[y][x]=COLORS[currentPiece];
      }
    }
  }
}

function clearLines(){
  let lines=0;
  for(let r=ROWS-1;r>=0;r--){
    if(board[r].every(cell=>cell!=="")){
      board.splice(r,1);
      board.unshift(new Array(COLS).fill(""));
      lines++; r++;
    }
  }
  if(lines>0){
    linesCleared+=lines;
    score+=[0,40,100,300,1200][lines]*level;
    level=Math.floor(linesCleared/10)+1;
    dropInterval=Math.max(100,1000-(level-1)*100);
    resetDropTimer();
  }
}

function spawnPiece(){
  currentPiece=nextPiece || Object.keys(TETROMINOS)[Math.floor(Math.random()*7)];
  nextPiece=Object.keys(TETROMINOS)[Math.floor(Math.random()*7)];
  currentX=Math.floor(COLS/2)-1; currentY=-1; currentRotation=0;
  drawNextPiece();
  if(!isValidPosition(currentX,currentY,currentRotation)) gameOver();
}

function move(dx,dy){
  if(isValidPosition(currentX+dx,currentY+dy,currentRotation)){
    currentX+=dx; currentY+=dy; draw(); return true;
  }
  return false;
}

function rotate(){
  const newRotation=(currentRotation+1)%TETROMINOS[currentPiece].length;
  if(isValidPosition(currentX,currentY,newRotation)){
    currentRotation=newRotation; draw();
  }
}

function drop(){
  if(!move(0,1)){
    placePiece(); clearLines(); spawnPiece();
  }
}

function gameOver(){ isGameOver=true; clearInterval(dropTimer); alert("Game Over! Score: "+score); }

function resetDropTimer(){
  if(dropTimer) clearInterval(dropTimer);
  dropTimer=setInterval(drop,dropInterval);
}

function startGame(){
  isGameOver=false; score=0; linesCleared=0;
  level=parseInt(levelSelect.value)||1;
  dropInterval=Math.max(100,1000-(level-1)*100);
  initBoard(); spawnPiece(); resetDropTimer(); draw();
}

function drawNextPiece(){
  nextPieceEl.innerHTML="";
  const shape=TETROMINOS[nextPiece][0];
  for(let r=0;r<4;r++){
    for(let c=0;c<4;c++){
      const cell=document.createElement("div");
      cell.classList.add("cell");
      if(shape[r] && shape[r][c]) cell.classList.add(COLORS[nextPiece]);
      nextPieceEl.appendChild(cell);
    }
  }
}

// Teclado
document.addEventListener("keydown",e=>{
  if(isGameOver) return;
  if(e.key==="ArrowLeft") move(-1,0);
  else if(e.key==="ArrowRight") move(1,0);
  else if(e.key==="ArrowDown") move(0,1);
  else if(e.key==="ArrowUp") rotate();
  else if(e.key===" ") drop();
});

// Botones táctiles
document.getElementById("left").addEventListener("click",()=>move(-1,0));
document.getElementById("right").addEventListener("click",()=>move(1,0));
document.getElementById("down").addEventListener("click",()=>move(0,1));
document.getElementById("rotate").addEventListener("click",()=>rotate());

startButton.addEventListener("click",startGame);

initBoard();
</script>
</body>
</html>
