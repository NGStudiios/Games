<html lang="es">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1" name="viewport"/>
  <title>
   Juego de Carreras de Autos Individual Mejorado
  </title>
  <script src="https://cdn.tailwindcss.com">
  </script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>
  <style>
   #gameArea {
      position: relative;
      overflow: hidden;
      background-color: #2d2d2d;
      border-radius: 0.5rem;
      height: 600px;
      max-width: 400px;
      margin: 0 auto;
      box-shadow: 0 0 20px #111;
    }
    /* Pista con bordes y c√©sped */
    #track {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(to bottom, #3a3a3a 0%, #2a2a2a 100%);
      z-index: 0;
      border-left: 40px solid #2f7a0f; /* c√©sped izquierdo */
      border-right: 40px solid #2f7a0f; /* c√©sped derecho */
      box-sizing: border-box;
      border-radius: 0.5rem;
    }
    /* L√≠neas centrales discontinuas */
    .roadLine {
      position: absolute;
      width: 12px;
      height: 60px;
      background-color: white;
      left: 50%;
      margin-left: -6px;
      border-radius: 6px;
      box-shadow: 0 0 8px white;
      z-index: 1;
    }
    /* L√≠neas laterales blancas */
    .sideLineLeft, .sideLineRight {
      position: absolute;
      width: 8px;
      height: 100%;
      background-color: white;
      top: 0;
      border-radius: 4px;
      box-shadow: 0 0 6px white;
      z-index: 1;
    }
    .sideLineLeft {
      left: 40px;
    }
    .sideLineRight {
      right: 40px;
    }
    /* Auto jugador */
    .playerCar {
      position: absolute;
      width: 50px;
      height: 100px;
      border-radius: 0.5rem;
      bottom: 20px;
      left: 50%;
      margin-left: -25px;
      z-index: 10;
      filter: drop-shadow(0 0 5px #ff0000);
      transition: left 0.15s ease;
    }
    /* Autos enemigos */
    .enemyCar {
      position: absolute;
      width: 50px;
      height: 100px;
      border-radius: 0.5rem;
      transition: top 0.1s linear, left 0.15s ease;
      filter: drop-shadow(0 0 5px #0000ff);
      z-index: 9;
    }
    /* Bot√≥n start */
    #startBtn {
      user-select: none;
    }
  </style>
 </head>
 <body class="bg-gray-900 text-white font-sans flex flex-col min-h-screen">
  <header class="p-4 bg-gray-800 text-center text-3xl font-extrabold tracking-wide select-none">
   üèÅ Juego de Carreras de Autos üèéÔ∏è
  </header>
  <main class="flex-grow flex flex-col items-center justify-center p-4">
   <div aria-atomic="true" aria-label="√Årea de juego de carreras de autos" aria-live="polite" aria-relevant="additions removals" class="relative shadow-lg" id="gameArea" role="main" tabindex="0">
    <div aria-hidden="true" id="track">
    </div>
    <div aria-hidden="true" class="sideLineLeft">
    </div>
    <div aria-hidden="true" class="sideLineRight">
    </div>
    <img alt="Auto rojo deportivo visto desde arriba, con detalles blancos, en pista de carreras" class="playerCar" height="100" id="playerCar" src="https://storage.googleapis.com/a1aa/image/aafd8098-975f-4c11-0bdf-a9e9309f7710.jpg" width="50"/>
    <div class="roadLine" style="top: 0px;">
    </div>
    <div class="roadLine" style="top: 150px;">
    </div>
    <div class="roadLine" style="top: 300px;">
    </div>
    <div class="roadLine" style="top: 450px;">
    </div>
    <div class="roadLine" style="top: 600px;">
    </div>
   </div>
   <div class="mt-6 flex flex-col items-center space-y-4 max-w-md w-full">
    <button aria-label="Iniciar juego de carreras" class="bg-green-600 hover:bg-green-700 px-6 py-3 rounded text-lg font-semibold transition focus:outline-none focus:ring-4 focus:ring-green-400" id="startBtn" type="button">
     Iniciar Juego
    </button>
    <div class="text-xl font-semibold select-none">
     Puntuaci√≥n:
     <span aria-atomic="true" aria-live="polite" id="score">
      0
     </span>
    </div>
    <div class="text-sm text-gray-400 max-w-xs text-center select-none">
     Usa las flechas izquierda y derecha para mover el auto. Evita los autos enemigos y sobrevive el mayor tiempo posible. ¬°Divi√©rtete!
    </div>
   </div>
  </main>
  <footer class="p-4 bg-gray-800 text-center text-gray-400 text-sm select-none">
   ¬© 2024 Juego de Carreras de Autos Mejorado
  </footer>
  <script>
   const gameArea = document.getElementById("gameArea");
    const playerCar = document.getElementById("playerCar");
    const startBtn = document.getElementById("startBtn");
    const scoreDisplay = document.getElementById("score");

    const gameAreaHeight = 600;
    const gameAreaWidth = 400;
    const laneWidth = 100; // ancho de cada carril
    const lanes = [gameAreaWidth / 2 - laneWidth, gameAreaWidth / 2, gameAreaWidth / 2 + laneWidth]; // 3 carriles

    let playerLane = 1; // carril central
    let enemyCars = [];
    let animationId;
    let score = 0;
    let gameRunning = false;
    let speed = 10; // velocidad base
    let enemySpeed = 6; // velocidad de autos enemigos
    let enemySpawnRate = 0.04; // probabilidad de generar enemigo cada frame

    // Autos enemigos con diferentes colores y estilos
    const enemyCarImages = [
      {
        src: "https://placehold.co/50x100/0000ff/ffffff?text=Auto+Azul",
        alt: "Auto azul deportivo visto desde arriba, con detalles blancos, en pista de carreras"
      },
      {
        src: "https://placehold.co/50x100/00ff00/000000?text=Auto+Verde",
        alt: "Auto verde deportivo visto desde arriba, con detalles negros, en pista de carreras"
      },
      {
        src: "https://placehold.co/50x100/ffff00/000000?text=Auto+Amarillo",
        alt: "Auto amarillo deportivo visto desde arriba, con detalles negros, en pista de carreras"
      },
      {
        src: "https://placehold.co/50x100/ff00ff/ffffff?text=Auto+Magenta",
        alt: "Auto magenta deportivo visto desde arriba, con detalles blancos, en pista de carreras"
      },
      {
        src: "https://placehold.co/50x100/00ffff/000000?text=Auto+Cian",
        alt: "Auto cian deportivo visto desde arriba, con detalles negros, en pista de carreras"
      }
    ];

    // Crear un auto enemigo
    function createEnemyCar() {
      const enemy = document.createElement("img");
      const carIndex = Math.floor(Math.random() * enemyCarImages.length);
      enemy.src = enemyCarImages[carIndex].src;
      enemy.alt = enemyCarImages[carIndex].alt;
      enemy.classList.add("enemyCar");
      enemy.style.top = "-120px";
      // Elegir carril aleatorio, evitar que dos enemigos est√©n en el mismo carril muy cerca
      let laneIndex;
      let tries = 0;
      do {
        laneIndex = Math.floor(Math.random() * lanes.length);
        tries++;
      } while (
        enemyCars.some(
          (e) =>
            parseInt(e.style.top) < 150 &&
            parseInt(e.dataset.lane) === laneIndex
        ) && tries < 10
      );
      enemy.dataset.lane = laneIndex;
      enemy.style.left = lanes[laneIndex] - 25 + "px";
      gameArea.appendChild(enemy);
      enemyCars.push(enemy);
    }

    // Mover l√≠neas de la carretera para simular movimiento
    function moveRoadLines() {
      const lines = document.querySelectorAll(".roadLine");
      lines.forEach((line) => {
        let top = parseInt(line.style.top);
        top += speed;
        if (top > gameAreaHeight) {
          top = -60;
        }
        line.style.top = top + "px";
      });
    }

    // Mover autos enemigos hacia abajo
    function moveEnemyCars() {
      enemyCars.forEach((enemy, index) => {
        let top = parseInt(enemy.style.top);
        top += enemySpeed;
        if (top > gameAreaHeight) {
          // Eliminar auto enemigo que sali√≥ de la pantalla
          enemy.remove();
          enemyCars.splice(index, 1);
          score++;
          scoreDisplay.textContent = score;
          // Aumentar dificultad progresivamente
          if (score % 10 === 0) {
            enemySpeed += 0.5;
            if (enemySpawnRate < 0.12) enemySpawnRate += 0.005;
          }
        } else {
          enemy.style.top = top + "px";
        }
      });
    }

    // Detectar colisiones
    function checkCollision() {
      const playerTop = gameAreaHeight - 120 - 20; // posici√≥n top del auto jugador
      const playerLeft = lanes[playerLane] - 25;
      const playerRight = playerLeft + 50;
      const playerBottom = gameAreaHeight - 20;

      for (let enemy of enemyCars) {
        const enemyTop = parseInt(enemy.style.top);
        const enemyLeft = lanes[parseInt(enemy.dataset.lane)] - 25;
        const enemyRight = enemyLeft + 50;
        const enemyBottom = enemyTop + 100;

        // Colisi√≥n simple por rect√°ngulos con margen para mejor jugabilidad
        if (
          playerBottom > enemyTop + 20 &&
          playerTop < enemyBottom - 20 &&
          playerRight > enemyLeft + 10 &&
          playerLeft < enemyRight - 10
        ) {
          return true;
        }
      }
      return false;
    }

    // Actualizar posici√≥n del auto jugador
    function updatePlayerPosition() {
      playerCar.style.left = lanes[playerLane] - 25 + "px";
    }

    // Loop principal del juego
    function gameLoop() {
      if (!gameRunning) return;

      moveRoadLines();
      moveEnemyCars();

      if (checkCollision()) {
        endGame();
        return;
      }

      // Crear nuevos autos enemigos aleatoriamente
      if (Math.random() < enemySpawnRate) {
        createEnemyCar();
      }

      animationId = requestAnimationFrame(gameLoop);
    }

    // Iniciar juego
    function startGame() {
      if (gameRunning) return;
      gameRunning = true;
      score = 0;
      scoreDisplay.textContent = score;
      enemySpeed = 6;
      enemySpawnRate = 0.04;

      // Limpiar autos enemigos previos
      enemyCars.forEach((enemy) => enemy.remove());
      enemyCars = [];

      playerLane = 1;
      updatePlayerPosition();

      gameLoop();
      startBtn.disabled = true;
      startBtn.classList.add("opacity-50", "cursor-not-allowed");
    }

    // Terminar juego
    function endGame() {
      gameRunning = false;
      cancelAnimationFrame(animationId);
      alert("¬°Juego terminado! Tu puntuaci√≥n: " + score);
      startBtn.disabled = false;
      startBtn.classList.remove("opacity-50", "cursor-not-allowed");
    }

    // Controlar movimiento con teclado
    window.addEventListener("keydown", (e) => {
      if (!gameRunning) return;
      if (e.key === "ArrowLeft" && playerLane > 0) {
        playerLane--;
        updatePlayerPosition();
      } else if (e.key === "ArrowRight" && playerLane < lanes.length - 1) {
        playerLane++;
        updatePlayerPosition();
      }
    });

    // Soporte t√°ctil para m√≥viles: swipe izquierda/derecha
    let touchStartX = null;
    let touchEndX = null;

    function handleGesture() {
      if (!gameRunning) return;
      if (touchEndX === null || touchStartX === null) return;
      const diffX = touchEndX - touchStartX;
      if (Math.abs(diffX) > 40) {
        if (diffX > 0 && playerLane < lanes.length - 1) {
          playerLane++;
          updatePlayerPosition();
        } else if (diffX < 0 && playerLane > 0) {
          playerLane--;
          updatePlayerPosition();
        }
      }
      touchStartX = null;
      touchEndX = null;
    }

    gameArea.addEventListener("touchstart", (e) => {
      touchStartX = e.changedTouches[0].screenX;
    });

    gameArea.addEventListener("touchend", (e) => {
      touchEndX = e.changedTouches[0].screenX;
      handleGesture();
    });

    startBtn.addEventListener("click", startGame);
  </script>
 </body>
</html>
